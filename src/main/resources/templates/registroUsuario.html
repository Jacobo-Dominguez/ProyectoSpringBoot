<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Usuario - SaaS Jacobo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css(v='1.1')}">
</head>

<body>

    <!-- Barra de Navegación -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container-fluid mx-auto" style="max-width: 1140px;">
            <a class="navbar-brand" href="/">SaaS Jacobo</a>
            <div class="d-flex align-items-center">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 flex-row gap-3">
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a class="nav-link" th:href="@{/suscripciones/ver/{id}(id=${currentUser.id})}">Suscripciones</a>
                    </li>
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a class="nav-link" th:href="@{/facturas/usuario/{id}(id=${currentUser.id})}">Facturación</a>
                    </li>
                    <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                        <a class="nav-link" th:href="@{/admin/auditoria}">Auditoría</a>
                    </li>
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <form th:action="@{/logout}" method="post" class="d-inline">
                            <button type="submit" class="btn btn-link nav-link">Cerrar Sesión</button>
                        </form>
                    </li>
                    <li class="nav-item" sec:authorize="isAnonymous()">
                        <a class="nav-link active" th:href="@{/usuarios/nuevo}">Registro</a>
                    </li>
                </ul>
                <span class="navbar-text ms-3 text-light fw-bold" th:if="${currentUser != null}"
                    th:text="${currentUser.nombre}"></span>
            </div>
        </div>
    </nav>

    <div class="container centered-container">
        <div class="card">
            <div class="text-center mb-4">
                <h2>Crea tu Cuenta</h2>
                <p class="text-muted">Únete a nuestra plataforma SaaS</p>
            </div>

            <div th:if="${param.error_email}" class="alert alert-danger">
                Este correo electrónico ya está registrado. Prueba con otro o inicia sesión.
            </div>

            <form th:action="@{/usuarios/guardar}" th:object="${usuario}" method="post">

                <h4 class="mb-3">Datos de Usuario</h4>
                <div class="row mb-3">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nombre Completo</label>
                        <input type="text" class="form-control" th:field="*{nombre}" placeholder="Juan Pérez" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" th:field="*{email}" placeholder="tu@email.com"
                            required>
                    </div>
                    <div class="col-12 mb-3">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-control" th:field="*{password}" required>
                    </div>
                </div>

                <hr>

                <h4 class="mb-3">Datos de Perfil</h4>
                <div class="row mb-3">
                    <div class="col-md-8 mb-3">
                        <label class="form-label">Dirección</label>
                        <input type="text" class="form-control" name="direccion" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ciudad</label>
                        <input type="text" class="form-control" name="ciudad" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Teléfono</label>
                        <input type="tel" class="form-control" name="telefono" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">País</label>
                        <select class="form-select" name="paisId" required>
                            <option value="">Selecciona tu país</option>
                            <option th:each="pais : ${paises}" th:value="${pais.id}"
                                th:text="${pais.nombre + ' (' + pais.tasaImpuesto + '% IVA)'}"></option>
                        </select>
                    </div>
                </div>

                <hr>

                <h4 class="mb-3">Selecciona tu Plan</h4>
                <div class="mb-4">
                    <select class="form-select" name="planId" required>
                        <option value="">Selecciona un plan</option>
                        <option th:each="plan : ${planes}" th:value="${plan.id}"
                            th:text="${plan.nombre + ' - €' + plan.precio + '/mes'}"></option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary w-100 py-2">Crear Cuenta</button>

            </form>
        </div>
    </div>

</body>

</html>